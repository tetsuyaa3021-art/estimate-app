<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="ja"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="utf-8" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;見積りMVP（ローカル/Pages）&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>:root{--bg:#0b1220;--card:#121b2f;--muted:#9fb0d0;--text:#e8eefc;--line:#24304d;--accent:#4cc3ff;--good:#36d399;--warn:#fbbf24}</p>
<p class="p1"><span class="Apple-converted-space">    </span>*{box-sizing:border-box}</p>
<p class="p1"><span class="Apple-converted-space">    </span>body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;background:linear-gradient(180deg,#071024,#0b1220);color:var(--text)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>header{padding:18px 20px;border-bottom:1px solid var(--line);position:sticky;top:0;background:rgba(11,18,32,.9);backdrop-filter:blur(10px);z-index:2}</p>
<p class="p1"><span class="Apple-converted-space">    </span>header h1{margin:0;font-size:16px;font-weight:700}</p>
<p class="p1"><span class="Apple-converted-space">    </span>header .sub{margin-top:6px;color:var(--muted);font-size:12px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>main{padding:18px;max-width:1200px;margin:0 auto}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.grid{display:grid;grid-template-columns:1.1fr .9fr;gap:14px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>@media (max-width: 980px){.grid{grid-template-columns:1fr}}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card{background:rgba(18,27,47,.92);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card h2{margin:0 0 10px;font-size:14px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>input,select,textarea{width:100%;padding:10px 10px;border-radius:12px;border:1px solid var(--line);background:#0b1428;color:var(--text);outline:none}</p>
<p class="p1"><span class="Apple-converted-space">    </span>textarea{min-height:62px;resize:vertical}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>button{border:1px solid var(--line);background:#0c1730;color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer}</p>
<p class="p1"><span class="Apple-converted-space">    </span>button.primary{background:linear-gradient(135deg,#1c76ff,#4cc3ff);border-color:transparent;color:#071024;font-weight:700}</p>
<p class="p1"><span class="Apple-converted-space">    </span>button.ghost{background:transparent}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.kpi{padding:10px;border:1px solid var(--line);border-radius:14px;background:#0b1428}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.kpi .t{font-size:12px;color:var(--muted)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.kpi .v{font-size:18px;font-weight:800;margin-top:4px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.mono{font-variant-numeric:tabular-nums}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.table{width:100%;border-collapse:collapse;margin-top:8px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.table th,.table td{border-bottom:1px solid var(--line);padding:10px 6px;font-size:12px;text-align:left}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.table th{color:var(--muted);font-weight:600}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);font-size:12px;color:var(--muted)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.pill b{color:var(--text)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.alert{margin-top:10px;padding:10px;border-radius:14px;border:1px solid var(--line);background:#0b1428}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.alert.good{border-color:rgba(54,211,153,.35)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.alert.warn{border-color:rgba(251,191,36,.45)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.hist{max-height:240px;overflow:auto;border:1px solid var(--line);border-radius:14px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.hist-item{padding:10px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;gap:10px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.hist-item:last-child{border-bottom:none}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.hist-item small{color:var(--muted)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>a{color:var(--accent)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>details summary{cursor:pointer;color:var(--muted);margin-top:8px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1">&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;h1&gt;見積りMVP（1ファイル / ローカル＆GitHub Pages対応）&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="sub"&gt;入力 → 原価内訳 → 3価格（基本/競争/推奨） / 履歴保存（ブラウザ）&lt;/div&gt;</p>
<p class="p1">&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;main&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="grid"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- INPUT --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;section class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h2&gt;見積入力&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;顧客名&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input id="customer" placeholder="例：◯◯工業" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;品目名&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input id="itemName" placeholder="例：ブラケットA" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;材質&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;select id="material"&gt;&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;難易度&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;select id="difficulty"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option&gt;標準&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option&gt;やや複雑&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option&gt;複雑&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;label&gt;サイズ（mm）&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="row3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;input id="x" type="number" min="1" value="50" placeholder="縦" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;input id="y" type="number" min="1" value="50" placeholder="横" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;input id="z" type="number" min="1" value="50" placeholder="高さ" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;数量（個）&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input id="qty" type="number" min="1" value="10" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;端数処理単位（円）&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;select id="moneyUnit"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option value="1"&gt;1&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option value="10"&gt;10&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option value="100" selected&gt;100&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;details&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;summary&gt;マスタ設定（まずはここを調整すれば自社仕様になります）&lt;/summary&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label&gt;人件費（円/時）&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;input id="laborRate" type="number" value="3000" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label&gt;設備費（円/時）&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;input id="machineRate" type="number" value="1500" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label&gt;間接費率（例 0.2 = 20%）&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;input id="overheadRate" type="number" step="0.01" value="0.20" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label&gt;利益率（基本 / 競争 / 下限）&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="row3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input id="profitBasic" type="number" step="0.01" value="0.25" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input id="profitComp" type="number" step="0.01" value="0.15" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input id="profitMin" type="number" step="0.01" value="0.05" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label&gt;サイズ区分の境界（体積cm3で S&amp;lt; / M&amp;lt; ）&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="row3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input id="thS" type="number" value="100" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input id="thM" type="number" value="500" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input id="dummy" disabled value="L=それ以上" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label&gt;標準工数（時間）：S/M/L × 難易度&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;textarea id="worktimeJson" spellcheck="false"&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;small style="color:var(--muted)"&gt;JSON形式。例は自動入力済み。必要に応じて編集。&lt;/small&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/details&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="btns"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="primary" id="btnCalc"&gt;計算&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="ghost" id="btnSample"&gt;サンプル読込&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="ghost" id="btnClear"&gt;クリア&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- RESULT --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;aside class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h2&gt;結果&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div style="display:flex;gap:10px;flex-wrap:wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="pill"&gt;サイズ区分：&lt;b id="sizeClass"&gt;-&lt;/b&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="pill"&gt;重量(kg)：&lt;b class="mono" id="weightKg"&gt;-&lt;/b&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="pill"&gt;原価合計：&lt;b class="mono" id="costTotal"&gt;-&lt;/b&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="kpis" style="margin-top:10px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="kpi"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="t"&gt;基本価格&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="v mono" id="priceBasic"&gt;-&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="kpi"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="t"&gt;競争価格&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="v mono" id="priceComp"&gt;-&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="kpi"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="t"&gt;推奨価格&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="v mono" id="priceRec"&gt;-&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="alert" id="alerts" style="display:none"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;table class="table"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;thead&gt;&lt;tr&gt;&lt;th&gt;内訳&lt;/th&gt;&lt;th&gt;金額(円)&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;tr&gt;&lt;td&gt;材料費&lt;/td&gt;&lt;td class="mono" id="cMat"&gt;-&lt;/td&gt;&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;tr&gt;&lt;td&gt;人件費&lt;/td&gt;&lt;td class="mono" id="cLab"&gt;-&lt;/td&gt;&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;tr&gt;&lt;td&gt;設備費&lt;/td&gt;&lt;td class="mono" id="cMac"&gt;-&lt;/td&gt;&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;tr&gt;&lt;td&gt;間接費&lt;/td&gt;&lt;td class="mono" id="cOvh"&gt;-&lt;/td&gt;&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/table&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h2 style="margin-top:14px"&gt;履歴（このブラウザ内）&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="hist" id="hist"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="btns" style="margin-top:10px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="btnExportJson"&gt;履歴をJSONでエクスポート&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="ghost" id="btnClearHist"&gt;履歴を全削除&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;small style="color:var(--muted)"&gt;※ GitHub Pagesでも同様にローカルストレージに保存されます。&lt;/small&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/aside&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p1">&lt;/main&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>// ---------- MASTER (初期値) ----------</p>
<p class="p1"><span class="Apple-converted-space">  </span>const MATERIALS = [</p>
<p class="p1"><span class="Apple-converted-space">    </span>{ id: 1, name: "鉄", <span class="Apple-converted-space">  </span>unitPricePerKg: 200, density: 7.85, lossRate: 0.05 },</p>
<p class="p1"><span class="Apple-converted-space">    </span>{ id: 2, name: "アルミ", unitPricePerKg: 600, density: 2.70, lossRate: 0.07 },</p>
<p class="p1"><span class="Apple-converted-space">  </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const WORKTIME_DEFAULT = {</p>
<p class="p1"><span class="Apple-converted-space">    </span>"S": { "標準": 0.8, "やや複雑": 1.2, "複雑": 1.6 },</p>
<p class="p1"><span class="Apple-converted-space">    </span>"M": { "標準": 1.2, "やや複雑": 1.8, "複雑": 2.4 },</p>
<p class="p1"><span class="Apple-converted-space">    </span>"L": { "標準": 2.0, "やや複雑": 3.0, "複雑": 4.0 },</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ---------- UTIL ----------</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $ = (id) =&gt; document.getElementById(id);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const yen = (n) =&gt; (isFinite(n) ? Math.round(n).toLocaleString("ja-JP") + " 円" : "-");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const num = (v, fallback=0) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const x = Number(v);</p>
<p class="p1"><span class="Apple-converted-space">    </span>return Number.isFinite(x) ? x : fallback;</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p1"><span class="Apple-converted-space">  </span>const roundMoney = (x, unit) =&gt; Math.round(x / unit) * unit;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function volumeCm3(xMm, yMm, zMm){</p>
<p class="p1"><span class="Apple-converted-space">    </span>return (xMm * yMm * zMm) / 1000; // mm3 -&gt; cm3</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>function weightKg(vCm3, density){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const wG = vCm3 * density; // g</p>
<p class="p1"><span class="Apple-converted-space">    </span>return wG / 1000; // kg</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>function sizeClassByVolume(vCm3, thS, thM){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (vCm3 &lt; thS) return "S";</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (vCm3 &lt; thM) return "M";</p>
<p class="p1"><span class="Apple-converted-space">    </span>return "L";</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ---------- HISTORY ----------</p>
<p class="p1"><span class="Apple-converted-space">  </span>const HIST_KEY = "estimate_mvp_history_v1";</p>
<p class="p1"><span class="Apple-converted-space">  </span>function loadHist(){ try{ return JSON.parse(localStorage.getItem(HIST_KEY) || "[]"); }catch{ return []; } }</p>
<p class="p1"><span class="Apple-converted-space">  </span>function saveHist(items){ localStorage.setItem(HIST_KEY, JSON.stringify(items)); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>function renderHist(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const items = loadHist();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const box = $("hist");</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!items.length){</p>
<p class="p1"><span class="Apple-converted-space">      </span>box.innerHTML = `&lt;div style="padding:12px;color:var(--muted)"&gt;まだ履歴がありません&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>box.innerHTML = items.map((it, idx) =&gt; `</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="hist-item"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div&gt;&lt;b&gt;${it.customer || "（顧客未入力）"}&lt;/b&gt; / ${it.itemName || "（品目未入力）"}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;small&gt;${new Date(it.ts).toLocaleString("ja-JP")} ・ 基本 ${it.priceBasic.toLocaleString("ja-JP")} 円&lt;/small&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div style="display:flex;gap:6px;align-items:center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;button data-act="restore" data-idx="${idx}"&gt;復元&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;button data-act="duplicate" data-idx="${idx}"&gt;複製&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;button data-act="delete" data-idx="${idx}"&gt;削除&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>`).join("");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>box.querySelectorAll("button").forEach(btn=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>btn.addEventListener("click", ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">        </span>const idx = Number(btn.dataset.idx);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const act = btn.dataset.act;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const items = loadHist();</p>
<p class="p1"><span class="Apple-converted-space">        </span>const it = items[idx];</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!it) return;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (act === "delete"){</p>
<p class="p1"><span class="Apple-converted-space">          </span>items.splice(idx,1); saveHist(items); renderHist(); return;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>// restore / duplicate: put inputs back</p>
<p class="p1"><span class="Apple-converted-space">        </span>applyInputs(it.inputs);</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (act === "restore") calcAndDisplay(true);</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (act === "duplicate") calcAndDisplay(false); // そのまま再計算</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function applyInputs(i){</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("customer").value = i.customer || "";</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("itemName").value = i.itemName || "";</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("material").value = String(i.materialId ?? 1);</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("difficulty").value = i.difficulty || "標準";</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("x").value = i.x ?? 50;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("y").value = i.y ?? 50;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("z").value = i.z ?? 50;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("qty").value = i.qty ?? 10;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("moneyUnit").value = String(i.moneyUnit ?? 100);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// master settings</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("laborRate").value = i.laborRate ?? 3000;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("machineRate").value = i.machineRate ?? 1500;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("overheadRate").value = i.overheadRate ?? 0.2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("profitBasic").value = i.profitBasic ?? 0.25;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("profitComp").value = i.profitComp ?? 0.15;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("profitMin").value = i.profitMin ?? 0.05;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("thS").value = i.thS ?? 100;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("thM").value = i.thM ?? 500;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("worktimeJson").value = i.worktimeJson ?? JSON.stringify(WORKTIME_DEFAULT, null, 2);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ---------- CALC ----------</p>
<p class="p1"><span class="Apple-converted-space">  </span>function readWorktime(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>try{</p>
<p class="p1"><span class="Apple-converted-space">      </span>const obj = JSON.parse($("worktimeJson").value);</p>
<p class="p1"><span class="Apple-converted-space">      </span>return obj;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}catch(e){</p>
<p class="p1"><span class="Apple-converted-space">      </span>throw new Error("標準工数JSONの形式が不正です。");</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function calc(inputs){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const mat = MATERIALS.find(m =&gt; m.id === inputs.materialId);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!mat) throw new Error("材質が見つかりません。");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const vCm3 = volumeCm3(inputs.x, inputs.y, inputs.z);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const sizeClass = sizeClassByVolume(vCm3, inputs.thS, inputs.thM);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const worktime = readWorktime();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const stdHours = worktime?.[sizeClass]?.[inputs.difficulty];</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!isFinite(stdHours)) throw new Error(`標準工数が未設定です（${sizeClass} × ${inputs.difficulty}）`);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const w1 = weightKg(vCm3, mat.density);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const wTotal = Math.round((w1 * inputs.qty) * 1000) / 1000; // 小数第3位</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const materialCost = mat.unitPricePerKg * wTotal * (1 + mat.lossRate);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const laborCost = stdHours * inputs.laborRate;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const machineCost = stdHours * inputs.machineRate;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const overhead = (materialCost + laborCost + machineCost) * inputs.overheadRate;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const costTotal = materialCost + laborCost + machineCost + overhead;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const minPrice = costTotal * (1 + inputs.profitMin);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const priceBasic = Math.max(minPrice, costTotal * (1 + inputs.profitBasic));</p>
<p class="p1"><span class="Apple-converted-space">    </span>const priceComp<span class="Apple-converted-space">  </span>= Math.max(minPrice, costTotal * (1 + inputs.profitComp));</p>
<p class="p1"><span class="Apple-converted-space">    </span>const priceRec <span class="Apple-converted-space">  </span>= Math.max(minPrice, priceBasic); // MVP: 推奨＝基本</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const pb = roundMoney(priceBasic, inputs.moneyUnit);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const pc = roundMoney(priceComp,<span class="Apple-converted-space">  </span>inputs.moneyUnit);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const pr = roundMoney(priceRec, <span class="Apple-converted-space">  </span>inputs.moneyUnit);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const grossRateBasic = pb &gt; 0 ? (pb - costTotal) / pb : 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const laborRateBasic = pb &gt; 0 ? laborCost / pb : 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>return {</p>
<p class="p1"><span class="Apple-converted-space">      </span>sizeClass,</p>
<p class="p1"><span class="Apple-converted-space">      </span>weightKg: wTotal,</p>
<p class="p1"><span class="Apple-converted-space">      </span>breakdown: { materialCost, laborCost, machineCost, overhead, costTotal },</p>
<p class="p1"><span class="Apple-converted-space">      </span>prices: { pb, pc, pr },</p>
<p class="p1"><span class="Apple-converted-space">      </span>kpi: { grossRateBasic, laborRateBasic }</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function showAlerts(res){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const alerts = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (res.kpi.laborRateBasic &gt; 0.25) alerts.push(`人件費率が25%を超えています（${(res.kpi.laborRateBasic*100).toFixed(1)}%）`);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (res.kpi.grossRateBasic &lt; 0.10) alerts.push(`粗利率が10%未満です（${(res.kpi.grossRateBasic*100).toFixed(1)}%）`);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const box = $("alerts");</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!alerts.length){</p>
<p class="p1"><span class="Apple-converted-space">      </span>box.style.display = "none";</p>
<p class="p1"><span class="Apple-converted-space">      </span>box.className = "alert";</p>
<p class="p1"><span class="Apple-converted-space">      </span>box.innerHTML = "";</p>
<p class="p1"><span class="Apple-converted-space">      </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>box.style.display = "block";</p>
<p class="p1"><span class="Apple-converted-space">    </span>box.className = "alert warn";</p>
<p class="p1"><span class="Apple-converted-space">    </span>box.innerHTML = "&lt;b&gt;注意&lt;/b&gt;&lt;br&gt;" + alerts.map(a=&gt;`・${a}`).join("&lt;br&gt;");</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function display(res){</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("sizeClass").textContent = res.sizeClass;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("weightKg").textContent = res.weightKg.toFixed(3);</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("costTotal").textContent = yen(res.breakdown.costTotal);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>$("priceBasic").textContent = yen(res.prices.pb);</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("priceComp").textContent<span class="Apple-converted-space">  </span>= yen(res.prices.pc);</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("priceRec").textContent <span class="Apple-converted-space">  </span>= yen(res.prices.pr);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>$("cMat").textContent = yen(res.breakdown.materialCost);</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("cLab").textContent = yen(res.breakdown.laborCost);</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("cMac").textContent = yen(res.breakdown.machineCost);</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("cOvh").textContent = yen(res.breakdown.overhead);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>showAlerts(res);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function readInputs(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>return {</p>
<p class="p1"><span class="Apple-converted-space">      </span>customer: $("customer").value.trim(),</p>
<p class="p1"><span class="Apple-converted-space">      </span>itemName: $("itemName").value.trim(),</p>
<p class="p1"><span class="Apple-converted-space">      </span>materialId: Number($("material").value),</p>
<p class="p1"><span class="Apple-converted-space">      </span>difficulty: $("difficulty").value,</p>
<p class="p1"><span class="Apple-converted-space">      </span>x: num($("x").value, 1),</p>
<p class="p1"><span class="Apple-converted-space">      </span>y: num($("y").value, 1),</p>
<p class="p1"><span class="Apple-converted-space">      </span>z: num($("z").value, 1),</p>
<p class="p1"><span class="Apple-converted-space">      </span>qty: Math.max(1, Math.floor(num($("qty").value, 1))),</p>
<p class="p1"><span class="Apple-converted-space">      </span>moneyUnit: Number($("moneyUnit").value),</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>laborRate: num($("laborRate").value, 3000),</p>
<p class="p1"><span class="Apple-converted-space">      </span>machineRate: num($("machineRate").value, 1500),</p>
<p class="p1"><span class="Apple-converted-space">      </span>overheadRate: num($("overheadRate").value, 0.2),</p>
<p class="p1"><span class="Apple-converted-space">      </span>profitBasic: num($("profitBasic").value, 0.25),</p>
<p class="p1"><span class="Apple-converted-space">      </span>profitComp: num($("profitComp").value, 0.15),</p>
<p class="p1"><span class="Apple-converted-space">      </span>profitMin: num($("profitMin").value, 0.05),</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>thS: num($("thS").value, 100),</p>
<p class="p1"><span class="Apple-converted-space">      </span>thM: num($("thM").value, 500),</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>worktimeJson: $("worktimeJson").value</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function calcAndDisplay(saveToHist=true){</p>
<p class="p1"><span class="Apple-converted-space">    </span>try{</p>
<p class="p1"><span class="Apple-converted-space">      </span>const inputs = readInputs();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const res = calc(inputs);</p>
<p class="p1"><span class="Apple-converted-space">      </span>display(res);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>if (saveToHist){</p>
<p class="p1"><span class="Apple-converted-space">        </span>const items = loadHist();</p>
<p class="p1"><span class="Apple-converted-space">        </span>items.unshift({</p>
<p class="p1"><span class="Apple-converted-space">          </span>ts: Date.now(),</p>
<p class="p1"><span class="Apple-converted-space">          </span>customer: inputs.customer,</p>
<p class="p1"><span class="Apple-converted-space">          </span>itemName: inputs.itemName,</p>
<p class="p1"><span class="Apple-converted-space">          </span>priceBasic: res.prices.pb,</p>
<p class="p1"><span class="Apple-converted-space">          </span>inputs</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>// keep last 50</p>
<p class="p1"><span class="Apple-converted-space">        </span>saveHist(items.slice(0,50));</p>
<p class="p1"><span class="Apple-converted-space">        </span>renderHist();</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}catch(e){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const box = $("alerts");</p>
<p class="p1"><span class="Apple-converted-space">      </span>box.style.display = "block";</p>
<p class="p1"><span class="Apple-converted-space">      </span>box.className = "alert warn";</p>
<p class="p1"><span class="Apple-converted-space">      </span>box.innerHTML = "&lt;b&gt;エラー&lt;/b&gt;&lt;br&gt;" + (e?.message || String(e));</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ---------- INIT ----------</p>
<p class="p1"><span class="Apple-converted-space">  </span>function init(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>// materials</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("material").innerHTML = MATERIALS.map(m=&gt;`&lt;option value="${m.id}"&gt;${m.name}&lt;/option&gt;`).join("");</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("worktimeJson").value = JSON.stringify(WORKTIME_DEFAULT, null, 2);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// history</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderHist();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// buttons</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("btnCalc").addEventListener("click", ()=&gt;calcAndDisplay(true));</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("btnClear").addEventListener("click", ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>["customer","itemName"].forEach(id=&gt;$(id).value="");</p>
<p class="p1"><span class="Apple-converted-space">      </span>["x","y","z"].forEach(id=&gt;$(id).value=50);</p>
<p class="p1"><span class="Apple-converted-space">      </span>$("qty").value=10;</p>
<p class="p1"><span class="Apple-converted-space">      </span>$("difficulty").value="標準";</p>
<p class="p1"><span class="Apple-converted-space">      </span>$("moneyUnit").value="100";</p>
<p class="p1"><span class="Apple-converted-space">      </span>$("sizeClass").textContent="-";</p>
<p class="p1"><span class="Apple-converted-space">      </span>["weightKg","costTotal","priceBasic","priceComp","priceRec","cMat","cLab","cMac","cOvh"].forEach(id=&gt;$(id).textContent="-");</p>
<p class="p1"><span class="Apple-converted-space">      </span>$("alerts").style.display="none";</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>$("btnSample").addEventListener("click", ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>applyInputs({</p>
<p class="p1"><span class="Apple-converted-space">        </span>customer:"テスト顧客A",</p>
<p class="p1"><span class="Apple-converted-space">        </span>itemName:"ブラケットA",</p>
<p class="p1"><span class="Apple-converted-space">        </span>materialId:1,</p>
<p class="p1"><span class="Apple-converted-space">        </span>difficulty:"やや複雑",</p>
<p class="p1"><span class="Apple-converted-space">        </span>x:80,y:60,z:40,qty:25,</p>
<p class="p1"><span class="Apple-converted-space">        </span>moneyUnit:100,</p>
<p class="p1"><span class="Apple-converted-space">        </span>laborRate:3200,</p>
<p class="p1"><span class="Apple-converted-space">        </span>machineRate:1600,</p>
<p class="p1"><span class="Apple-converted-space">        </span>overheadRate:0.22,</p>
<p class="p1"><span class="Apple-converted-space">        </span>profitBasic:0.25,</p>
<p class="p1"><span class="Apple-converted-space">        </span>profitComp:0.15,</p>
<p class="p1"><span class="Apple-converted-space">        </span>profitMin:0.05,</p>
<p class="p1"><span class="Apple-converted-space">        </span>thS:120, thM:700,</p>
<p class="p1"><span class="Apple-converted-space">        </span>worktimeJson: JSON.stringify(WORKTIME_DEFAULT, null, 2)</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>calcAndDisplay(false);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>$("btnClearHist").addEventListener("click", ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!confirm("履歴を全削除します。よろしいですか？")) return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>saveHist([]);</p>
<p class="p1"><span class="Apple-converted-space">      </span>renderHist();</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>$("btnExportJson").addEventListener("click", ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>const data = JSON.stringify(loadHist(), null, 2);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const blob = new Blob([data], {type:"application/json"});</p>
<p class="p1"><span class="Apple-converted-space">      </span>const url = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const a = document.createElement("a");</p>
<p class="p1"><span class="Apple-converted-space">      </span>a.href = url;</p>
<p class="p1"><span class="Apple-converted-space">      </span>a.download = "estimate_history.json";</p>
<p class="p1"><span class="Apple-converted-space">      </span>document.body.appendChild(a);</p>
<p class="p1"><span class="Apple-converted-space">      </span>a.click();</p>
<p class="p1"><span class="Apple-converted-space">      </span>a.remove();</p>
<p class="p1"><span class="Apple-converted-space">      </span>URL.revokeObjectURL(url);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>init();</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
